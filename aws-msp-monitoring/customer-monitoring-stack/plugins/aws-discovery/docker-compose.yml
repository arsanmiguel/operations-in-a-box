networks:
  default:
    external: false
services:
  aws_discovery:
    container_name: aws_discovery
    environment:
    - AWS_REGION=${AWS_REGION}
    - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
    - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
    - DISCOVERY_INTERVAL=${DISCOVERY_INTERVAL}
    - DISCOVERY_SERVICES=${DISCOVERY_SERVICES}
    healthcheck:
      interval: 60s
      retries: 3
      start_period: 60s
      test:
      - CMD
      - wget
      - --no-verbose
      - --tries=1
      - --spider
      - http://localhost:9118/health
      timeout: 10s
    image: alpine:latest
    networks:
    - default
    ports:
    - 9118:9118
    restart: unless-stopped
    volumes:
    - ./aws-discovery-config.yml:/config/config.yml:ro
    - ./logs:/var/log:rw
